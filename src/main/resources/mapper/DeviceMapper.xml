<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lot.mapper.DeviceMapper">

    <insert id="saveDevice" parameterType="com.lot.entity.Device">
        insert into t_device(f_station_no, f_dev_no, f_var_list_fields, f_var_list_fields_md5,
        f_start_receive_time, f_end_receive_time)
        values (#{stationNo}, #{devNo}, #{varListFields}, MD5(f_var_list_fields), #{startReceiveTime}, #{endReceiveTime})
    </insert>

    <update id="updateSameDeviceCounter" parameterType="java.lang.String">
        update t_device set f_end_receive_time = #{endReceiveTime},
                    f_start_receive_time = f_start_receive_time,
                f_receive_count = f_receive_count + 1
        where f_station_no = #{stationNo}
        and f_var_list_fields_md5 = #{varListFieldsMd5}
    </update>

    <select id="checkDeviceExist" parameterType="java.lang.String" resultType="java.lang.Long">
        select count(1) as total from t_device
         where MD5(f_var_list_fields) = #{varList4FieldsMd5}
         and f_station_no = #{stationNo}
    </select>

    <select id="getDeviceInfoAll" parameterType="java.lang.String" resultType="com.lot.entity.DeviceInfo">
        select f_dev_no as devNo, f_station_no as stationNo, f_dev_name as devName,
                f_dev_type as devType, f_dev_var_fields as devVarFields from t_device_info
        where f_station_no = #{stationNo}
    </select>

</mapper>
